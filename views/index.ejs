<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Auth</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { margin:0; background:#0f172a; color:#e2e8f0; }
    header { padding:16px; text-align:center; background:#111827; border-bottom:1px solid #1f2937; }
    main { max-width:900px; margin:24px auto; padding:0 16px 32px; display:grid; gap:24px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:24px; }
    .card { background:#111827; border:1px solid #1f2937; border-radius:14px; padding:16px; }
    h2 { margin:0 0 12px; font-size:18px; }
    form { display:grid; gap:12px; }
    label { font-weight:600; }
    input { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #334155; background:#0b1220; color:#e2e8f0; }
    button { padding:10px 14px; border-radius:10px; border:1px solid #334155; background:#0b1220; color:#e2e8f0; cursor:pointer; }
    button:hover { filter:brightness(1.08); }
    .msg { padding:10px 12px; border-radius:10px; }
    .ok { background:#064e3b; border:1px solid #065f46; }
    .err { background:#7f1d1d; border:1px solid #991b1b; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  </style>
</head>
<body>
  <header><h1>Autenticación</h1></header>

  <main>
    <% if (typeof msg === 'string' && msg) { %>
      <div class="msg ok"><%= msg %></div>
    <% } %>
    <% if (typeof error === 'string' && error) { %>
      <div class="msg err"><%= error %></div>
    <% } %>

    <% if (email) { %>
      <div class="card">
        <h2>Sesión</h2>
        <p>Estás logueado como <b><%= email %></b></p>
        <div class="row">
          <form method="post" action="/logout">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit">Cerrar sesión</button>
          </form>
          <a href="/protected"><button type="button">Ir a /protected</button></a>
          <a href="/admin"><button type="button">Ir a /admin</button></a>
        </div>
      </div>
    <% } %>

    <section class="grid">
      <div class="card">
        <h2>Registro</h2>
        <form method="post" action="/register">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <div>
            <label for="reg-email">Email</label>
            <input id="reg-email" name="email" type="email" required />
          </div>
          <div>
            <label for="reg-password">Contraseña</label>
            <input id="reg-password" name="password" type="password" required />
          </div>
          <button type="submit">Crear cuenta</button>
        </form>
      </div>

      <div class="card">
        <h2>Login</h2>
        <form method="post" action="/login">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <div>
            <label for="log-email">Email</label>
            <input id="log-email" name="email" type="email" required />
          </div>
          <div>
            <label for="log-password">Contraseña</label>
            <input id="log-password" name="password" type="password" required />
          </div>
          <button type="submit">Iniciar sesión</button>
        </form>
      </div>
    </section>
  </main>
</body>
</html>
